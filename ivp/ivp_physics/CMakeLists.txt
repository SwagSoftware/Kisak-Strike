# Cmake script for ivp_physics

cmake_minimum_required(VERSION 3.16)
project(ivp_physics)
set(SRCDIR "${CMAKE_SOURCE_DIR}")
set(CMAKE_MODULE_PATH ${SRCDIR}/cmake)
set(OUTLIBNAME "ivp_physics")

include(${CMAKE_MODULE_PATH}/detect_platform.cmake)
include(${CMAKE_MODULE_PATH}/source_lib_base.cmake)

include_directories(${SRCDIR}/ivp/ivp_physics)
include_directories(${SRCDIR}/ivp/ivp_utility)
include_directories(${SRCDIR}/ivp/ivp_compact_builder)
include_directories(${SRCDIR}/ivp/ivp_collision)
include_directories(${SRCDIR}/ivp/ivp_controller)
include_directories(${SRCDIR}/ivp/ivp_surface_manager)
include_directories(${SRCDIR}/ivp/ivp_intern)

if( LINUXALL )
    target_compile_options(${OUTLIBNAME} PRIVATE -fpic -fno-semantic-interposition)
    #TODO: pretty sure the valve guy made a typo here, it's supposed to be MAVOK_MOPP
    add_definitions(-D_LIB -DIVP_VERSION_SDK -DHAVANA_CONSTRAINTS -DHAVOK_MOOP -DLINUX)
endif()

#IVP_PHYSICS_SRC_DIR
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_3d_solver.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_clustering_longrange.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_clustering_lrange_hash.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_clustering_visual_hash.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_clustering_visualizer.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_coll_del_root_mindist.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_collision_filter.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_compact_ledge.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_compact_ledge_solver.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_i_collision_vhash.cxx)
set_source_files_properties(../ivp_collision/ivp_i_collision_vhash.cxx PROPERTIES COMPILE_FLAGS -O0) #Related to get_cache_object - Will crash without this :))
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_mindist.cxx)
set_source_files_properties(../ivp_collision/ivp_mindist.cxx PROPERTIES COMPILE_FLAGS -O0) #Related to get_cache_object - Will crash without this :))
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_mindist_debug.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_mindist_event.cxx)
set_source_files_properties(../ivp_collision/ivp_mindist_event.cxx PROPERTIES COMPILE_FLAGS -O0) #Related to get_cache_object - Will crash without this :))
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_mindist_mcases.cxx)
set_source_files_properties(../ivp_collision/ivp_mindist_mcases.cxx PROPERTIES COMPILE_FLAGS -O0) #Related to get_cache_object - Will crash without this :))
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_mindist_minimize.cxx)
set_source_files_properties(../ivp_collision/ivp_mindist_minimize.cxx PROPERTIES COMPILE_FLAGS -O0) #Related to get_cache_object - Will crash without this :))

#TODO: This file needs -O0 or it will start skipping if statements WTF!!!
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_mindist_recursive.cxx)
set_source_files_properties(../ivp_collision/ivp_mindist_recursive.cxx PROPERTIES COMPILE_FLAGS -O0)

target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_oo_watcher.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_range_manager.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_ray_solver.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_collision/ivp_sphere_solver.cxx)
#IVP_INTERN_SRC_DIR
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_ball.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_calc_next_psi_solver.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_controller_phantom.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_core.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_environment.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_friction.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_friction_gaps.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_great_matrix.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_hull_manager.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_i_friction_hash.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_impact.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_i_object_vhash.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_merge_core.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_mindist_friction.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_object_attach.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_object.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_physic.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_physic_private.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_polygon.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_sim_unit.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_solver_core_reaction.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_intern/ivp_time.cxx)
#IVP_UTILITY_SRC_DIR
target_sources(${OUTLIBNAME} PRIVATE ../ivp_utility/ivu_active_value.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_utility/ivu_bigvector.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_utility/ivu_geometry.cxx)
set_source_files_properties(../ivp_utility/ivu_geometry.cxx PROPERTIES COMPILE_FLAGS -O0) #Related to get_cache_object - Will crash without this :))
target_sources(${OUTLIBNAME} PRIVATE ../ivp_utility/ivu_hash.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_utility/ivu_linear.cxx)
set_source_files_properties(../ivp_utility/ivu_linear.cxx PROPERTIES COMPILE_FLAGS -O0) #Related to get_cache_object - Will crash without this :))
target_sources(${OUTLIBNAME} PRIVATE ../ivp_utility/ivu_mapping.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_utility/ivu_memory.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_utility/ivu_min_hash.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_utility/ivu_min_list.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_utility/ivu_os_dep.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_utility/ivu_quat.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_utility/ivu_string.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_utility/ivu_types.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_utility/ivu_vector.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_utility/ivu_vhash.cxx)
#IVP_PHYSICS_COL_SRC_DIR
target_sources(${OUTLIBNAME} PRIVATE ../ivp_physics/ivp_anomaly_manager.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_physics/ivp_betterdebugmanager.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_physics/ivp_betterstatisticsmanager.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_physics/ivp_cache_object.cxx)
set_source_files_properties(../ivp_physics/ivp_cache_object.cxx PROPERTIES COMPILE_FLAGS -O0) #Related to get_cache_object - Will crash without this :))
target_sources(${OUTLIBNAME} PRIVATE ../ivp_physics/ivp_liquid_surface_descript.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_physics/ivp_material.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_physics/ivp_performancecounter.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_physics/ivp_stat_manager_cback_con.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_physics/ivp_surface_manager.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_physics/ivp_templates.cxx)
#IVP_SURFACE_MANAGER_SRC_DIR
target_sources(${OUTLIBNAME} PRIVATE ../ivp_surface_manager/ivp_compact_surface.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_surface_manager/ivp_gridbuild_array.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_surface_manager/ivp_surman_grid.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_surface_manager/ivp_surman_polygon.cxx)
#IVP_CONTROLLER_SRC_DIR
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_actuator.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_actuator_spring.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_buoyancy_solver.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_car_system.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_constraint_car.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_constraint.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_constraint_fixed_keyed.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_constraint_local.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_controller_buoyancy.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_controller_floating.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_controller_motion.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_controller_raycast_car.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_controller_stiff_spring.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_controller_world_frict.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_forcefield.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_multidimensional_interp.cxx)
target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/ivp_template_constraint.cxx)

#IVP_CONTROLLER_VALVE_SRC_DIR
#target_sources(${OUTLIBNAME} PRIVATE ../ivp_controller/)